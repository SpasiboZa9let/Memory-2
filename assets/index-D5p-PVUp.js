import"./index-BGqyXoT0.js";function y(l,e=document){return e.querySelector(l)}class v{constructor(e,s,t,i){if(this.mapEl=y(e),this.markers=s,this.panel=t,this.progress=i,this.viewedIds=new Set,!this.mapEl){console.error(`Map container "${e}" not found`);return}this.mapEl.style.position="relative",this._onResize=this._renderMarkers.bind(this),window.addEventListener("resize",this._onResize),this._renderMarkers()}_renderMarkers(){this.mapEl.querySelectorAll(".marker").forEach(t=>t.remove());const{width:e,height:s}=this.mapEl.getBoundingClientRect();this.markers.forEach(t=>{if(t.x<0||t.x>1||t.y<0||t.y>1)return;const i=document.createElement("div");i.className="marker",i.style.left=`${t.x*e}px`,i.style.top=`${t.y*s}px`,i.style.backgroundImage=`url(${t.img})`,i.title=t.title||"",i.addEventListener("click",()=>{var n,o;(n=this.panel)!=null&&n.ready&&this.panel.show(t);const c=t.title||`${t.x}_${t.y}`;this.viewedIds.has(c)||(this.viewedIds.add(c),(o=this.progress)==null||o.markViewed())}),this.mapEl.appendChild(i)})}destroy(){window.removeEventListener("resize",this._onResize)}}class w{constructor(e){this.panel=document.querySelector(e),this.img=this.panel.querySelector("img"),this.caption=this.panel.querySelector(".text"),this.subtitle=this.panel.querySelector("#memory-subtitle"),this.dim=document.getElementById("dim-overlay"),this.ready=!0,this.dim.addEventListener("click",()=>this.hide());let s=null;this.panel.addEventListener("touchstart",t=>{t.touches.length===1&&(s=t.touches[0].clientY)}),this.panel.addEventListener("touchmove",t=>{if(!s||t.touches.length>1)return;t.touches[0].clientY-s<-30&&(t.preventDefault(),this.hide(),s=null)},{passive:!1}),this.panel.addEventListener("touchend",()=>{s=null})}show(e){this.ready&&(this.ready=!1,this.img.src=e.img,this.caption.textContent=e.title||"Без подписи",this.subtitle.classList.remove("show"),this.subtitle.textContent=e.subtitle||"",e.subtitle&&(this.subtitle.style.transition="none",this.subtitle.offsetHeight,this.subtitle.style.transition="",this.subtitle.classList.add("show")),this.panel.classList.add("show"),this.dim.classList.add("visible"),document.documentElement.classList.add("noscroll"),document.body.classList.add("noscroll"),setTimeout(()=>{this.ready=!0},3e3))}hide(){this.panel.classList.remove("show"),this.dim.classList.remove("visible"),document.documentElement.classList.remove("noscroll"),document.body.classList.remove("noscroll"),this.ready=!0}}class f{constructor(e,s,t){this.total=e,this.viewed=0,this.bar=document.querySelector(s),this.btn=document.querySelector(t),this.btn&&this.btn.classList.add("hidden"),console.log("Прогрессбар инициализирован")}markViewed(){this.viewed+=1;const e=Math.min(this.viewed/this.total*100,100);this.bar.style.width=`${e}%`,this.viewed>=this.total&&this.btn&&this.btn.classList.remove("hidden")}}const u=[{x:.15,y:.2,img:"photos/1.jpg",title:"Завтрак в кафе",subtitle:"Хорошее начало дня"},{x:.3,y:.25,img:"photos/2.jpg",title:"Поездка на велосипеде",subtitle:"Свобода и ветер в лицо"},{x:.45,y:.3,img:"photos/3.jpg",title:"Старый мост",subtitle:"Переход к новому"},{x:.6,y:.35,img:"photos/4.jpg",title:"Берёзовая роща",subtitle:"Тишина и свежесть природы"},{x:.75,y:.4,img:"photos/5.jpg",title:"Станция",subtitle:"Каждая остановка важна"},{x:.7,y:.6,img:"photos/6.jpg",title:"Озеро",subtitle:"Отражение внутри себя"},{x:.55,y:.65,img:"photos/7.jpg",title:"Скала",subtitle:"Ты сильнее, чем думаешь"},{x:.4,y:.7,img:"photos/8.jpg",title:"Поле",subtitle:"Простор мечты"},{x:.25,y:.75,img:"photos/9.jpg",title:"Домик у реки",subtitle:"Тепло начинается с воспоминаний"},{x:.1,y:.8,img:"photos/10.jpg",title:"Закат",subtitle:"Красота в каждом завершении"}];function x(){const l=Array.from(document.querySelectorAll(".marker"));if(l.length<2)return;const e=document.getElementById("map"),s=e.getBoundingClientRect(),t=l.map(h=>{const r=h.getBoundingClientRect();return{x:r.left+r.width/2-s.left,y:r.top+r.height/2-s.top}}),i=[];i.push(`M ${t[0].x},${t[0].y}`);for(let h=1;h<t.length;h++){const r=t[h-1],d=t[h],m=r.x+(d.x-r.x)/3,p=r.y,g=r.x+2*(d.x-r.x)/3,b=d.y;i.push(`C ${m},${p} ${g},${b} ${d.x},${d.y}`)}const c=document.getElementById("route-svg");c&&c.remove();const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("viewBox",`0 0 ${s.width} ${s.height}`),n.setAttribute("id","route-svg"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.zIndex="2",n.style.pointerEvents="none";const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",i.join(" ")),o.setAttribute("fill","none"),o.setAttribute("stroke","#b32200"),o.setAttribute("stroke-width","2"),o.setAttribute("stroke-linecap","round");const a=o.getTotalLength();o.style.strokeDasharray=a,o.style.strokeDashoffset=a,o.style.transition="stroke-dashoffset 2s ease-out",n.appendChild(o),e.appendChild(n),requestAnimationFrame(()=>{o.style.strokeDashoffset="0"})}class E{constructor(){this.enabled=!1}initOnce(){this.enabled=!0,console.log("Звук включён")}toggle(){return this.enabled=!this.enabled,this.enabled}}class L{constructor(e,s){this.imageEl=document.querySelector(e),this.photos=s,this.current=0,this.prevBtn=document.querySelector("#prev-photo"),this.nextBtn=document.querySelector("#next-photo"),this.closeBtn=document.querySelector("#album-close"),this.modal=document.querySelector("#album-modal"),this._bind(),this._render()}_bind(){this.prevBtn.addEventListener("click",()=>this._prev()),this.nextBtn.addEventListener("click",()=>this._next()),this.closeBtn.addEventListener("click",()=>this.hide())}_render(){this.imageEl.src=this.photos[this.current],this.imageEl.alt=`Фото ${this.current+1}`}_prev(){this.current=(this.current-1+this.photos.length)%this.photos.length,this._render()}_next(){this.current=(this.current+1)%this.photos.length,this._render()}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}}function S(){const l=new w("#memory-panel"),e=new f(u.length,"#progress-bar","#open-album");new v("#map",u,l,e),setTimeout(x,100);const s=new E;document.addEventListener("click",()=>s.initOnce(),{once:!0});const t=new L("#album-image",["album/1.jpg","album/2.jpg","album/3.jpg","album/4.jpg","album/5.jpg","album/6.jpg","album/7.jpg","album/8.jpg","album/9.jpg","album/10.jpg","album/11.jpg"]),i=document.querySelector("#open-album");i&&i.addEventListener("click",()=>t.show())}export{S as initMap};
