function f(o,e=document){return e.querySelector(o)}class w{constructor(e,r,t){if(this.mapEl=f(e),this.markers=r,this.panel=t,!this.mapEl){console.error(`Map container "${e}" not found`);return}this.mapEl.style.position="relative",this._onResize=this._renderMarkers.bind(this),window.addEventListener("resize",this._onResize),this._renderMarkers()}_renderMarkers(){this.mapEl.querySelectorAll(".marker").forEach(t=>t.remove());const{width:e,height:r}=this.mapEl.getBoundingClientRect();this.markers.forEach(t=>{if(t.x<0||t.x>1||t.y<0||t.y>1)return;const s=document.createElement("div");s.className="marker",s.style.left=`${t.x*e}px`,s.style.top=`${t.y*r}px`,s.style.backgroundImage=`url(${t.img})`,s.title=t.title||"",s.addEventListener("click",()=>{var c;(c=this.panel)!=null&&c.ready&&this.panel.show(t)}),this.mapEl.appendChild(s)})}destroy(){window.removeEventListener("resize",this._onResize)}}class b{constructor(e){this.panel=document.querySelector(e),this.img=document.createElement("img"),this.caption=document.createElement("div"),this.panel.appendChild(this.img),this.panel.appendChild(this.caption),this.panel.style.display="none",this.ready=!0}show(e){this.ready&&(this.ready=!1,this.img.src=e.img,this.caption.textContent=e.title||"Без подписи",this.panel.style.display="block",setTimeout(()=>{this.ready=!0},3e3))}hide(){this.panel.style.display="none",this.ready=!0}}class x{constructor(e,r,t){this.bar=document.querySelector(r),this.btn=document.querySelector(t),console.log("Прогрессбар инициализирован")}}const u=[{x:.5,y:.5,img:"photos/1.jpg",title:"Пример"}];function E(){const o=Array.from(document.querySelectorAll(".marker"));if(o.length<2)return;const e=document.getElementById("map"),r=e.getBoundingClientRect(),t=o.map(a=>{const l=a.getBoundingClientRect();return{x:l.left+l.width/2-r.left,y:l.top+l.height/2-r.top}}),s=[];s.push(`M ${t[0].x},${t[0].y}`);for(let a=1;a<t.length;a++){const l=t[a-1],h=t[a],p=l.x+(h.x-l.x)/3,y=l.y,m=l.x+2*(h.x-l.x)/3,g=h.y;s.push(`C ${p},${y} ${m},${g} ${h.x},${h.y}`)}const c=document.getElementById("route-svg");c&&c.remove();const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("viewBox",`0 0 ${r.width} ${r.height}`),n.setAttribute("id","route-svg"),n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.zIndex=2,n.style.pointerEvents="none";const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",s.join(" ")),i.setAttribute("fill","none"),i.setAttribute("stroke","#b32200"),i.setAttribute("stroke-width","2"),i.setAttribute("stroke-linecap","round");const d=i.getTotalLength();i.style.strokeDasharray=d,i.style.strokeDashoffset=d,i.style.transition="stroke-dashoffset 2s ease-out",n.appendChild(i),e.appendChild(n),requestAnimationFrame(()=>{i.style.strokeDashoffset="0"})}class v{constructor(){this.enabled=!1}initOnce(){this.enabled=!0,console.log("Звук включён")}toggle(){return this.enabled=!this.enabled,this.enabled}}function A(){const o=new b("#memory-panel");new w("#map",u,o),new x(u.length,"#progress-bar","#open-album"),setTimeout(E,100);const e=new v;document.addEventListener("click",()=>e.initOnce(),{once:!0})}export{A as initMap};
